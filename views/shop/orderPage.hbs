
<div class="order-page">
    <div class="main-wrap">
        <div class="subwrap1">
            <div class="wrap-item item1">
                <div class="carousel carousel-main">
                    <div class="carousel-cell" style="background-image: url('/images/ex1 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex 2 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex3 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex4 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex5 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex6 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex7 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex8 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex9 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex10 cut.jpg')"></div>
                </div>
            </div>
            <div class="wrap-item item2">
                <div class="carousel carousel-nav">
                    <div class="carousel-cell" style="background-image: url('/images/ex1 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex 2 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex3 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex4 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex5 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex6 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex7 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex8 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex9 cut.jpg')"></div>
                    <div class="carousel-cell" style="background-image: url('/images/ex10 cut.jpg')"></div>
                </div>
            </div>
        </div>
        <!-- <img src="priceff.png"> -->
        <div class="subwrap2">
            <div class="wrap-item item3">
                <div class="description-of-sale">
                    <div class="title">Original Dream Portrait Art</div>
                    <div class="order-page-rating">
                        <img class="star-rating" src="/images/filled_star.png"
                             alt="">
                        <img class="star-rating" src="/images/filled_star.png"
                             alt="">
                        <img class="star-rating" src="/images/filled_star.png"
                             alt="">
                        <img class="star-rating" src="/images/filled_star.png"
                             alt="">
                        <img class="star-rating" src="/images/filled_star.png"
                             alt="">
                        <span class="reviews-qty">20 reviews</span>
                    </div>
                    {{#if hasReviews}}
                        <div style="display: flex; margin: 10px 0">
                            <div>
                                {{#each averageRating}}
                                    {{# if this }}
                                        <img class="star-rating"
                                             src="/images/filled_star.png"
                                             alt="">
                                    {{else}}
                                        <img class="star-rating"
                                             src="/images/empty_star.png"
                                             alt="">
                                    {{/ if }}
                                {{/each}}
                            </div>
                            <div class="reviews-qty">20{{ reviewsAmount }}
                                reviews
                            </div>
                            <!--                    <img style="max-height: 23px" src="/images/stars.png">-->
                        </div>
                    {{/if}}
                    <div class="total-price" id="total-price-page-static">
                        <del>$98</del><b class="text-danger">$49</b>
                    </div>
                </div>
            </div>
            <div class="wrap-item item4">
                <div class="order-form">
                    <div class="title text-center mb-2">PLACE YOUR ORDER IN 4 STEPS</div>
                    <div class="number-of-people-block">
                        <div class="sub-title mb-2"><b class="pr-2">1</b>Choose number of people & pets</div>
                        <div style="display: flex; justify-content: space-between;">
                            <button data-price="49" data-id="1" class="people-amount-image">1</button>
                            <button data-price="59" data-id="2" class="people-amount-image">2</button>
                            <button data-price="69" data-id="3" class="people-amount-image">3</button>
                            <button data-price="79" data-id="4" class="people-amount-image">4</button>
                            <button data-price="89" data-id="5" class="people-amount-image">5</button>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <button data-price="99" data-id="6" class="people-amount-image">6</button>
                            <button data-price="109" data-id="7" class="people-amount-image">7</button>
                            <button data-price="119" data-id="8" class="people-amount-image">8</button>
                            <button data-price="129" data-id="9" class="people-amount-image">9</button>
                            <button data-price="139" data-id="10" class="people-amount-image">10</button>
                        </div>
                        <small class="form-text text-danger error-message">required</small>
                    </div>

                    <div class="background-image-block mt-3">
                        <div class="sub-title mb-2"><b class="pr-2">2</b>Choose Background</div>
                        <!-- TODO: rework to gallery-->
                        <div class="slidercontainerBcgr" style="margin: 15px auto">
                            <div class="showSlideBcgr">
                                <img src="/images/12x18 H castle.jpg"/>
                            </div>
                            <div class="showSlideBcgr">
                                <img src="/images/18x12 H beach.jpg"/>
                            </div>
                            <div class="showSlideBcgr">
                                <img src="/images/12x18 H hearts.jpg"/>
                            </div>
                            <div class="showSlideBcgr">
                                <img src="/images/12x18 H starry night.jpg"/>
                            </div>
                            <div class="showSlideBcgr">
                                <img src="/images/12x18 bokeh.jpg"/>
                            </div>
                            <div class="showSlideBcgr" style="padding: 30px 0">
                                <h1 style="text-align:center;">Custom Background<br>+25$</h1>
                            </div>
                        </div>
                        <div class="bcgr-items" style="display: flex; justify-content: space-between;">
                            <img data-price="0" data-id="14" class="background-image" src="/images/12x18 H castle.jpg"
                                 name="Castle" width="70" height="70" onclick="currentSlideBcgr(1)">
                            <img data-price="0" data-id="12" class="background-image" src="/images/18x12 H beach.jpg"
                                 name="Beach" width="70" height="70" onclick="currentSlideBcgr(2)">
                            <img data-price="0" data-id="13" class="background-image" src="/images/12x18 H hearts.jpg"
                                 name="Hearts" width="70" height="70" onclick="currentSlideBcgr(3)">
                            <img data-price="0" data-id="11" class="background-image" src="/images/12x18 H starry night.jpg"
                                 name="Starry Night" onclick="currentSlideBcgr(4)">
                            <img data-price="0" data-id="15" class="background-image" src="/images/12x18 bokeh.jpg"
                                 name="Bokeh" width="70" height="70" onclick="currentSlideBcgr(5)">
                            <img data-price="25" data-id="111" name="Custom" class="background-image"
                                 src="/images/custom.png" onclick="currentSlideBcgr(6)">
                        </div>
                        <small class="form-text text-danger error-message">required</small>
                    </div>

                    <div class="notes-block mt-3">
                        <div class="sub-title mb-2"><b class="pr-2">3</b>Add notes (eye color, particular accessories, details, special text)</div>
                        <textarea id="text-in" class="form-control mt-3" maxlength="500" rows="4"></textarea>
                    </div>

                    <div class="photo-block mt-3">
                        <div class="sub-title mb-2"><b class="pr-2">4</b>Upload your photo</div>
                        <div class="mt-3">
                            <input id="upload-image" type="file" class="filepond" name="filepond">
                            <input type="text" class="filepond" name="image-url" hidden>
                        </div>
                        <small class="form-text text-danger error-message">required</small>
                    </div>

                    <div class="total-price text-center mt-3">
                        <del>$98</del><b class="text-danger">$49</b>
                    </div>

                    <div class="text-center mt-3">
                        <button class="full-btn" id="add-to-cart"><span>ADD TO CART</span></button>
                    </div>
                </div>
            </div>

            <div class="wrap-item item4">
                <div class="counter">
                    <img src="/images/eye.png">
                    <div class="text">
                        <b id="demo">17</b>
                        People are currently looking at this product
                    </div>
                </div>
                <div class="deliver">
                    <img src="/images/airport.png">
                    <div class="text"> Estimated delivery time 3-5 days</div>
                </div>
            </div>

            <div class="wrap-item item9 info-section">
                <h5 class="info-section-title title text-center mb-3">TURN YOUR PHOTO INTO A CARTOON!</h5>
                <p class="px-2 text-center font-size-08">
                    It's Simple! Just customize your
                    package using the buttons above, upload
                    your photo, leave us a note and leave the rest
                    to us!
                </p>
                <p class="px-2 text-center font-size-1 text-uppercase font-weight-bold">
                    JUST THINK OF THE
                    REACTION YOUR FRIENDS OR
                    FAMILY WOULD HAVE!
                </p>
                <div class="info-section-image">
                    <img src="/images/info_section_1.jpg">
                </div>
                <p class="px-2 text-center">
                    Each design is <b>100% hand-draw</b> by a real
                    artist using a digital tablet. No gimmick or
                    special effects - <b>just skilled artistry that will
                    capture every detail.</b>
                </p>
                <p class="px-2 mt-3 text-center">
                    You will receive a <b>downloadable JPEG file</b> that
                    can be used <b>digitally</b> or for <b>high-quality print.</b>
                </p>
                <div class="info-section-image">
                    <img src="/images/info_section_2.jpg">
                </div>
                <p class="px-2 text-center text-uppercase">
                    Don't know if you will like it? Don't worry!
                    We offer free unlimited revisions! We will
                    work together until you are 100% happy with
                    the final result.
                </p>
                <p class="px-2 mt-3 font-weight-bold text-center text-uppercase font-size-125">
                    What are you waiting for!!!
                </p>
            </div>
        </div>
    </div>
</div>
<script>
    initFilePond()
    initFlickityCarousel()

    function initFilePond () {
        FilePond.registerPlugin(FilePondPluginFileValidateType);
        FilePond.registerPlugin(FilePondPluginImagePreview);
        FilePond.registerPlugin(FilePondPluginFileValidateSize);
        FilePond.create(
                document.querySelector('#upload-image'),
                {
                    acceptedFileTypes: ['image/*'],
                    maxFileSize: '10MB',
                    credits: false,
                    labelIdle: '<span class="filepond--label-action">Upload Photo</span>',
                    server: {
                        process: function (fieldName, file, metadata, load, error, progress, abort) {
                            // upload image to s3
                            s3.upload({
                                Key: `photos/${Date.now()}_${file.name}`,
                                Body: file,
                                ContentType: file.type,
                                ContentDisposition: 'attachment',
                                ACL: 'public-read'
                            }, function(err, data) {
                                if (err) return error('Something went wrong')

                                $('input[name=image-url]').val(data.Location)

                                load(data.Key);
                            });
                        }
                    }
                }
        );
    }

    function initFlickityCarousel () {
        $('.carousel-main').flickity({ pageDots: false });
        $('.carousel-nav').flickity({ asNavFor: '.carousel-main', contain: true, pageDots: false, prevNextButtons: false });
    }

    // dynamic counter
    var x = 0;

    setInterval(function () {
        var x = Math.floor((Math.random() * 7) + 15);
        document.getElementById("demo").innerHTML = x;
    }, 6000);

    // dynamic counter
</script>
<script>
    // slider for bacground
    var slide_index_bcgr = 1;
    displaySlidesBcgr(slide_index_bcgr);

    function nextSlideBcgr(h) {
        displaySlidesBcgr(slide_index_bcgr += h);
    }

    function currentSlideBcgr(h) {
        displaySlidesBcgr(slide_index_bcgr = h);
    }


    function displaySlidesBcgr(h) {
        var y;
        var slidesBcgr = document.getElementsByClassName("showSlideBcgr");
        if (h > slidesBcgr.length) {
            slide_index_bcgr = 1
        }
        if (h < 1) {
            slide_index_bcgr = slidesBcgr.length
        }
        for (y = 0; y < slidesBcgr.length; y++) {
            slidesBcgr[y].style.display = "none";
        }
        slidesBcgr[slide_index_bcgr - 1].style.display = "block";
    }

    // slider for bacground

    // =============================

    // order data variables
    var selectedPeopleAmount = null;
    var selectedBakcground = null;
    var wishesText = null;
    // order data variables


    var addToCart = document.getElementById('add-to-cart');
    var textIn = document.getElementById('text-in');

    addToCart.addEventListener('click', function (event) {
        // validations
        if (!selectedPeopleAmount || !selectedBakcground || !getImageURL()) {
            $('.number-of-people-block .error-message').toggle(!selectedPeopleAmount)
            $('.background-image-block .error-message').toggle(!selectedBakcground)
            $('.photo-block .error-message').toggle(!getImageURL())
            return false
        }

        var localStorageCart = JSON.parse(localStorage.getItem("cart"));

        if (localStorageCart == null) {
            localStorageCart = [];
        }

        localStorageCart.push({
            selectedPeople: selectedPeopleAmount,
            selectedBakcground: selectedBakcground,
            wishesText: wishesText,
            imageUrl: getImageURL()
        });

        localStorage.setItem("cart", JSON.stringify(localStorageCart));
        updateCartQty();
        if (localStorageCart.length > 0) {
            window.location.href = '/cart-page';
        }
    });

    function getImageURL () {
      return $('input[name=image-url]').val()
    }


    var backgroundImage = document.getElementsByClassName("background-image");

    for (var i = 0; i < backgroundImage.length; i++) {
        backgroundImage[i].addEventListener('click', function (event) {
            for (var j = 0; j < backgroundImage.length; j++) {
                backgroundImage[j].className = "background-image";
            }

            var price = Number(event.target.getAttribute('data-price'));
            var id = event.target.getAttribute('data-id');
            var name = event.target.getAttribute('name');

            event.target.className += " people-amount-image-clicked";

            selectedBakcground = {
                id: id,
                price: price,
                name: name
            };
            priceForAll();

        });
    }


    var peopleAmountImages = document.getElementsByClassName("people-amount-image");

    for (var i = 0; i < peopleAmountImages.length; i++) {
        peopleAmountImages[i].addEventListener('click', function (event) {

            for (var j = 0; j < peopleAmountImages.length; j++) {
                peopleAmountImages[j].className = "people-amount-image";
            }

            var price = Number(event.target.getAttribute('data-price'));
            var id = event.target.getAttribute('data-id');

            event.target.className += " people-amount-image-clicked";

            selectedPeopleAmount = {
                id: id,
                price: price
            };
            priceForAll();
        });
    }


    var priceForAll = () => {
        var peoplePricePage = selectedPeopleAmount ? selectedPeopleAmount.price : 0;
        var backgroundPricePage = selectedBakcground ? selectedBakcground.price : 0;

        var totalPricePage = peoplePricePage + backgroundPricePage;

        if (selectedPeopleAmount.price != null) {
            $('.total-price').html(`<del>$${totalPricePage * 2}</del><b class="text-danger">$${totalPricePage}</b>`)
        }
    }


    function showCartElement() {
        var localStorageCart = JSON.parse(localStorage.getItem("cart"));
        var totalPrice = 0;

        if (!localStorageCart) {
            return;
        }

        var shoppingCart = document.getElementById('cart');
        shoppingCart.innerHTML = '';

        for (var i = 0; i < localStorageCart.length; i++) {
            var item = localStorageCart[i];
            totalPrice += item.selectedPeople.price + item.selectedBakcground.price;
            // if (item.selectedBakcground != null) {
            //     totalPrice += item.selectedBakcground.price;
            // }
            // if (item.image != null) {
            shoppingCart.innerHTML +=
                    "<li>People: " + item.selectedPeople.id + " - $" + item.selectedPeople.price +
                    " : " + item.selectedBakcground.name + " - $" + item.selectedBakcground.price + "</li>";
            // } else {
            //     shoppingCart.innerHTML +=
            //         "<li>People: " + item.selectedPeople.id + " - $" + item.selectedPeople.price + "</li>";
            // }
        }

        var totalPriceElement = document.getElementById('total-price');
        totalPriceElement.innerHTML = 'Total Price : $' + totalPrice;
    }


    textIn.addEventListener('input', function (event) {
        wishesText = event.target.value;
    });
</script>
